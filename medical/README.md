# 医療診断エージェント

ローカルLLM（Foundry Local + Phi-4-mini）とクラウドLLM（Azure AI Agent Framework）を組み合わせた**ハイブリッド型医療診断支援システム**です。

## 機能

1. **症状チェッカー（クラウド）**: 非緊急診断のガイダンス提供
2. **検査レポート要約（ローカル）**: 機密医療データのローカル処理

## ハイブリッド構成の利点

| 利点 | 説明 |
|------|------|
| **プライバシー保護** | 検査データはローカルで処理、クラウドに送信しない |
| **コスト最適化** | 基本処理はローカル、複雑な推論のみクラウド |
| **低遅延** | ローカル処理による即座の応答 |

## アーキテクチャ

```
ユーザー入力（患者症例 + 検査レポート）
    │
    ▼
┌─────────────────────────────────────┐
│   Azure AI Agent Framework          │
│   (症状チェッカー)                   │
│   - レッドフラグ症状の検出           │
│   - ツール呼び出し判断               │
└─────────────────────────────────────┘
    │
    ├─ 検査データあり → summarize_lab_report ツール
    │                      │
    │                      ▼
    │              ┌─────────────────────────────────────┐
    │              │   Foundry Local (Phi-4-mini)        │
    │              │   - 検査レポートのJSON構造化         │
    │              └─────────────────────────────────────┘
    │                      │
    ▼                      ▼
┌─────────────────────────────────────┐
│   最終ガイダンス生成                 │
│   - 診断判断                         │
│   - 次のステップ提案                 │
└─────────────────────────────────────┘
```

## 前提条件

1. **Foundry Localのインストール・起動**
   ```powershell
   winget install Microsoft.FoundryLocal
   foundry model download phi-4-mini
   foundry model load phi-4-mini
   foundry service status  # ポート確認
   ```

2. **Azure CLIログイン**
   ```powershell
   az login
   ```

3. **依存パッケージのインストール**
   ```powershell
   pip install -r requirements.txt
   ```

## 実行方法

```powershell
# プロジェクトルートから実行
python -m medical.agent
```

## サンプル出力

```
[ローカルツール] 検査レポート要約を実行中...
[Foundry Local] POST http://127.0.0.1:52403/v1/chat/completions
[ローカルツール] パース済み検査要約JSON:
{
  "overall_assessment": "炎症マーカーの上昇と軽度の白血球増多が認められ、急性感染症を示唆",
  "notable_abnormal_results": [...]
}

=== 症状チェッカー（ハイブリッド: ローカルツール + クラウドエージェント） ===

【診断ガイダンス】
1. 主な所見: 10代の患者で発熱(40度)、頭痛、嘔吐
2. 検査結果の要約: 炎症マーカー(CRP, ESR)の上昇、白血球増多
3. 推奨される次のステップ: 医療機関への受診をお勧めします
...
これは医学的アドバイスではありません。
```

## ファイル構成

```
medical/
├── __init__.py          # パッケージ初期化
├── agent.py             # メインエージェント
├── DESIGN.md            # 設計書
└── README.md            # 本ファイル
```

## 関連ドキュメント

- [設計書](./DESIGN.md) - 詳細なアーキテクチャと技術仕様
- [プロジェクト全体のREADME](../README.md) - ハイブリッドAIプロジェクト概要
